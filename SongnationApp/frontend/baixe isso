#!/usr/bin/env bash
# Script "baixe isso" — instala dependências necessárias para este projeto
# Coloque este arquivo na pasta SongnationApp e execute: ./"baixe isso"

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$ROOT_DIR"

echo "========================================"
echo "Songnation - instalador rápido (baixe isso)"
echo "Pasta do projeto: $ROOT_DIR"
echo "========================================"

# Verifica Node.js
if ! command -v node >/dev/null 2>&1; then
  cat <<'MSG'
Node.js não encontrado.
Instale Node.js (recomendado: https://nodejs.org/) e execute este script novamente.
Se você usa Linux, pode instalar via nvm (https://github.com/nvm-sh/nvm).
MSG
  exit 1
fi

# Verifica npm
if ! command -v npm >/dev/null 2>&1; then
  echo "npm não encontrado. Por favor instale npm (vem com Node.js) e tente novamente."
  exit 1
fi

echo "Instalando dependências do projeto (se houver)..."
npm install --no-audit --no-fund

# Garante que exista um método prático para servir a pasta localmente
echo "Verificando disponibilidade do comando 'serve' (via npx)..."
if ! npx --no-install serve --version >/dev/null 2>&1; then
  echo "'serve' não está disponível localmente. Instalando como devDependency..."
  npm install --no-audit --no-fund --save-dev serve
fi

echo
echo "Pronto! Como usar:" 
echo "  1) Para servir o diretório localmente na porta 8080 execute:"
echo "     npx serve . -l 8080"
echo "  2) Ou use o script npm start (se preferir):"
echo "     npm run start"
echo
echo "Observações:"
echo " - Este script evita instalações globais. Se quiser instalar globalmente, rode: npm install -g serve"
echo " - Em ambientes com permissões restritas, considere usar nvm para gerenciar Node/npm."

exit 0
